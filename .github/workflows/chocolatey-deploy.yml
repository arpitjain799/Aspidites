on:
  push:
    tags:
      - v*

jobs:
  test:
    runs-on: windows-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Set env
        run: echo "RELEASE_VERSION=${GITHUB_REF#refs/*/}" | sed 's/v//' >> $GITHUB_ENV
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Choco Pack
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: pack
      -
        name: Choco Install
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: install Aspidites -dv -s .
      -
        name: Choco Logon
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: apikey --key ${{ secrets.CHOCOLATEY_TOKEN }} --source https://push.chocolatey.org/
      -
        name: Choco Push
        uses: crazy-max/ghaction-chocolatey@v1
        with:
          args: push MyPackage.${{ env.RELEASE_VERSION }}.nupkg --source https://push.chocolatey.org/


